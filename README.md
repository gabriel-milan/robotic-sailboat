# Robotic Sailboat - Wingsail Control

This repository aims to share knowledge about robotic sailboats, since it's a subject of my personal interest. The content here has been developed by me and, as I'm an Electronic and Computer Engineering student, some of it may have mistakes, please keep aware and warn me about something messed up.

## Introduction

In 2017, Minerva Náutica (https://www.facebook.com/minervanautica/), a brazilian team from the Federal University of Rio de Janeiro that develops RC and robotic vessels joined the International Robotic Sailing Competition (https://www.sailbot.org/) for the first time, on its 11th edition, as the first team on the whole southern hemisphere that participated in a competition of that category.

At the time, we were very excited about our results on the competition, getting 5th place in general score and 1st place in the presentation of the project, tied with WPI, a huge team that got 1st place in general score in 2017 and 2018 (information updated on September, 2018).

This is a theoretical, very simple and low cost algorithm very similar to the one used by Minerva Náutica on 2017 that tries to increase boat performance by controlling the wingsail.

## Considerations

For the algorithm you'll see here, there are a few considerations made, as this was my conditions at the time:
* You have a single rigid wingsail;
* You know all the lift/drag coefficients for your single wingsail;
* You have no worries about heeling forces generated by aerodynamics.


## Background

As said on [Wikipedia](https://en.wikipedia.org/wiki/Forces_on_sails),
>**Forces on sails** result from movement of air that interacts with sails and gives them motive power for sailing craft.

There are two forces that results from movement of the air on an airfoil, called Lift and Drag forces, one that's orthogonal to the surface of the airfoil and to the wind (Lift) and the other on the same direction of the apparent wind (a concept as shown on Picture 1 below). These forces are represented on Picture 2.
<br>
<table align="center">
<caption align="bottom">Picture 1 - Apparent wind</caption>
<td><img src="https://www.sailbetter.com/wp-content/uploads/2012/07/Apparent-wind-2-e1341646651230-300x293.png"/></td>
</table>
<br>
<br>
<table align="center">
<caption align="bottom">Picture 2 - Airfoil streamlines</caption>
<td><img src="https://upload.wikimedia.org/wikipedia/commons/d/dd/Simple_airfoil_streamlines.png"/></td>
</table>
<br>
And there is a mathematical model which is applied to the design of sails we'll be using for this algorithm that is

$F = \frac{1}{2} \rho V^2A  \cdot C_{F}$

where $C_{F}$ is the coefficient for the force, that could be $C_{D}$ for drag force and $C_{L}$ for lift force, both of them depending on $\alpha$, which is the angle of attack (or the angle between the apparent wind and the sail).

Working on the forces on sail, we can see that there's a force that "pushes" the vessel forward, called the Driving force($F_R$), indicated below on Picture 3, as Lift Force ($L$) and Drag Force ($D$):

<br>
<table align="center">
<caption align="bottom">Picture 3 - Forces on sail</caption>
<td><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Boatforcestop.svg/845px-Boatforcestop.svg.png"/></td>
</table>
<br>

In order to compute the driving force, we have:

$F_R = L \cdot sin(\alpha) - D\cdot cos(\alpha)$

what gives us:

$F_R = \frac{1}{2} \rho V^2A  \cdot  (C_{L} \cdot sin(\alpha) - C_{D} \cdot cos(\alpha))$

Considering we aren't able to increase $A$, the area of the sail, and since we can't change $\rho$, which is the density of the air, we can assume them as constants so, in order to increase $F_R$ we need to increase either $V$, the speed of the apparent wind, or maximize $C_{L} \cdot sin(\alpha) - C_{D} \cdot cos(\alpha)$, which from now on I'll call $C_R$, or *"driving force coefficient"*, so

$C_R = C_{L} \cdot sin(\alpha) - C_{D} \cdot cos(\alpha)$

And since $C_L$ and $C_D$ depends only on $\alpha$, we can rewrite the equation:

$C_R(\alpha) = C_{L}(\alpha) \cdot sin(\alpha) - C_{D}(\alpha) \cdot cos(\alpha)$

so that $C_R$ depends on $\alpha$ only!

## Example - NACA 0015

In order to explain how it was done back in 2017 as accurately as possible, I'll take the NACA 0015 airfoil for this example. The only auxiliary code I used here is on  `examples/`.

### What does NACA 0015 stands for?
 
 >"The **NACA airfoils** are airfoil shapes for aircraft wings developed by the National Advisory Committee for Aeronautics (NACA)." -- Wikipedia

This one, particularly, is a symmetrical 4-digit airfoil and the *"15"* in *0015* indicates the airfoil has a 15% thickness to chord length ratio or, in other words, it is 15% as thick as it is long.

Basically, this is what it looks like:

<br>
<table align="center">
<caption align="bottom">Picture 4 - NACA 0015 airfoil</caption>
<td><img src="http://airfoiltools.com/images/airfoil/fxlv152-il_l.png"/></td>
</table>
<br>

### NACA 0015 coefficients

Back in 2017, I got these coefficients from a free software called [Javafoil](https://www.mh-aerotools.de/airfoils/javafoil.htm). For this example I'll get data from the same website I got the picture above, [AirfoilTools.com](http://airfoiltools.com), using the Reynolds number approximately 200 (for information on Reynolds number, please check [this](https://en.wikipedia.org/wiki/Reynolds_number)).

So now we're going to plot $C_L$, $C_D$ and $C_R$ against $\alpha$ to see what we're dealing with:

<br>
<table align="center">
<caption align="bottom">Picture 5 - Lift coefficient vs Alpha</caption>
<td><img src="https://github.com/gabriel-milan/robotic-sailboat/blob/master/examples/images/Lift_coeff.png?raw=true"/></td>
</table>
<br>

<br>
<table align="center">
<caption align="bottom">Picture 6 - Drag coefficient vs Alpha</caption>
<td><img src="https://github.com/gabriel-milan/robotic-sailboat/blob/master/examples/images/Drag_coeff.png?raw=true"/></td>
</table>
<br>

<br>
<table align="center">
<caption align="bottom">Picture 7 - Driving coefficient vs Alpha</caption>
<td><img src="https://github.com/gabriel-milan/robotic-sailboat/blob/master/examples/images/Driving_coeff.png?raw=true"/></td>
</table>
<br>

It is pretty intuitive that $C_D$ and $C_D$ are mirrored on $X^+$ and $X^-$, and $C_L$ on $X^+$ equals $-C_L$ on $X^-$, being $X$ the horizontal axis on the charts. This said, from now on we'll only use the $X^+$ side of them.

### The stall issue

As we can see on the *"Lift coefficient vs Alpha"* chart, next to 14 degrees, it has its greatest value and then starts decreasing very fast. This phenomenon is called *stall*, and it's defined by:
>"A stall is a condition in aerodynamics and aviation wherein the angle of attack increases beyond a certain point such that lift begins to decrease. The angle at which this occurs is called the *critical angle of attack*.
>[...]
>[Flow separation](https://en.wikipedia.org/wiki/Flow_separation) begins to occur at small angles of attack while attached flow over the wing is still dominant. As angle of attack increases, the separated regions on the top of the wing increase in size and hinder the wing's ability to create lift. At the critical angle of attack, separated flow is so dominant that additional incr\alphaeases in angle of attack produce less lift and more drag." -- Wikipedia

In other words, it may be risky to choose an *"ideal"* $\alpha$ greater than the *critical angle* ($\alpha_C$, from now on), even though its $C_R$ may be greater than $\alpha_C$'s.

### Choosing $\alpha$

Okay, now that we know how to do it, let's just do it!

On the auxiliary code I uploaded, there's a function `max_value (data, x_label, y_label)` that returns the greatest $Y$ value in the dataset for the given $Y$ versus $X$ chart and its respective $X$ value. This considered, the output we get for $C_L \times \alpha$ and $C_R \times \alpha$, respectively, is the following:

`(14.25, 1.2139)`
`(14.5, 0.254183875029455)`

This is pretty clear if we plot both $C_L$ (in red) and $C_R$ (in green), as follows:

<br>
<table align="center">
<caption align="bottom">Picture 8 - Lift and Driving coefficients vs Alpha</caption>
<td><img src="https://github.com/gabriel-milan/robotic-sailboat/blob/master/examples/images/CL_CR_vs_Alpha.png?raw=true"/></td>
</table>
<br>

Being aware of the *stall* issue, we shall consider taking our $\alpha = 14.25$ instead of $14.5$ but, as curious as I am, I got to check the difference it will bring me, so I'll check the value of $C_R$ for $\alpha = 14.25$ too.

In this particular example, $C_R = 0.253639$ for $\alpha = 14.25$, which will give me 

$\frac{C_R(14.25)}{C_R(14.5)} = \frac{0.253639}{0.254183} = 99,8\%$ of the best performance according to this model.

This is a risk I, personally, wouldn't take, considering the tiny difference on performance. So, for this example, we'll be assuming 

>$\alpha = 14.25$

as our final answer.

----------

> ---> TODO:
>* Simple example Arduino code to control sail
>* Final considerations
