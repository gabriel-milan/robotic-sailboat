# Robotic Sailboat - Wingsail Control

This repository aims to share knowledge about robotic sailboats, since it's a subject of my personal interest. The content here has been developed by me and, as I'm an Electronic and Computer Engineering student, some of it may have mistakes, please keep aware and warn me about something messed up.

## Introduction

In 2017, Minerva Náutica (https://www.facebook.com/minervanautica/), a brazilian team from the Federal University of Rio de Janeiro that develops RC and robotic vessels joined the International Robotic Sailing Competition (https://www.sailbot.org/) for the first time, on its 11th edition, as the first team on the whole southern hemisphere that participated in a competition of that category.

At the time, we were very excited about our results on the competition, getting 5th place in general score and 1st place in the presentation of the project, tied with WPI, a huge team that got 1st place in general score in 2017 and 2018 (information updated on September, 2018).

This is a theoretical, very simple and low cost algorithm very similar to the one used by Minerva Náutica on 2017 that tries to increase boat performance by controlling the wingsail.

## Considerations

For the algorithm you'll see here, there are a few considerations made, as this was my conditions at the time:
* You have a single rigid wingsail;
* You know all the lift/drag coefficients for your single wingsail;
* You have no worries about heeling forces generated by aerodynamics.


## Background

As said on [Wikipedia](https://en.wikipedia.org/wiki/Forces_on_sails),
>**Forces on sails** result from movement of air that interacts with sails and gives them motive power for sailing craft.

There are two forces that results from movement of the air on an airfoil, called Lift and Drag forces, one that's orthogonal to the surface of the airfoil and to the wind (Lift) and the other on the same direction of the apparent wind (a concept as shown on Picture 1 below). These forces are represented on Picture 2.
<br>
<table align="center">
<caption align="bottom">Picture 1 - Apparent wind</caption>
<td><img src="https://www.sailbetter.com/wp-content/uploads/2012/07/Apparent-wind-2-e1341646651230-300x293.png"/></td>
</table>
<br>
<br>
<table align="center">
<caption align="bottom">Picture 2 - Airfoil streamlines</caption>
<td><img src="https://upload.wikimedia.org/wikipedia/commons/d/dd/Simple_airfoil_streamlines.png"/></td>
</table>
<br>
And there is a mathematical model which is applied to the design of sails we'll be using for this algorithm that is

<a href="https://www.codecogs.com/eqnedit.php?latex=F&space;=&space;\frac{1}{2}&space;\rho&space;V^2A&space;\cdot&space;C_{F}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?F&space;=&space;\frac{1}{2}&space;\rho&space;V^2A&space;\cdot&space;C_{F}" title="F = \frac{1}{2} \rho V^2A \cdot C_{F}" /></a>

where <a href="https://www.codecogs.com/eqnedit.php?latex=C_{F}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_{F}" title="C_{F}" /></a> is the coefficient for the force, that could be <a href="https://www.codecogs.com/eqnedit.php?latex=C_{D}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_{D}" title="C_{D}" /></a> for drag force and <a href="https://www.codecogs.com/eqnedit.php?latex=C_{L}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_{L}" title="C_{L}" /></a> for lift force, both of them depending on <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a>, which is the angle of attack (or the angle between the apparent wind and the sail).

Working on the forces on sail, we can see that there's a force that "pushes" the vessel forward, called the Driving force(<a href="https://www.codecogs.com/eqnedit.php?latex=F_R" target="_blank"><img src="https://latex.codecogs.com/gif.latex?F_R" title="F_R" /></a>), indicated below on Picture 3, as Lift Force (<a href="https://www.codecogs.com/eqnedit.php?latex=L" target="_blank"><img src="https://latex.codecogs.com/gif.latex?L" title="L" /></a>) and Drag Force (<a href="https://www.codecogs.com/eqnedit.php?latex=D" target="_blank"><img src="https://latex.codecogs.com/gif.latex?D" title="D" /></a>):

<br>
<table align="center">
<caption align="bottom">Picture 3 - Forces on sail</caption>
<td><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Boatforcestop.svg/845px-Boatforcestop.svg.png"/></td>
</table>
<br>

In order to compute the driving force, we have:

<a href="https://www.codecogs.com/eqnedit.php?latex=F_R&space;=&space;L&space;\cdot&space;sin(\alpha)&space;-&space;D\cdot&space;cos(\alpha)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?F_R&space;=&space;L&space;\cdot&space;sin(\alpha)&space;-&space;D\cdot&space;cos(\alpha)" title="F_R = L \cdot sin(\alpha) - D\cdot cos(\alpha)" /></a>

what gives us:

<a href="https://www.codecogs.com/eqnedit.php?latex=F_R&space;=&space;\frac{1}{2}&space;\rho&space;V^2A&space;\cdot&space;(C_{L}&space;\cdot&space;sin(\alpha)&space;-&space;C_{D}&space;\cdot&space;cos(\alpha))" target="_blank"><img src="https://latex.codecogs.com/gif.latex?F_R&space;=&space;\frac{1}{2}&space;\rho&space;V^2A&space;\cdot&space;(C_{L}&space;\cdot&space;sin(\alpha)&space;-&space;C_{D}&space;\cdot&space;cos(\alpha))" title="F_R = \frac{1}{2} \rho V^2A \cdot (C_{L} \cdot sin(\alpha) - C_{D} \cdot cos(\alpha))" /></a>

Considering we aren't able to increase <a href="https://www.codecogs.com/eqnedit.php?latex=A" target="_blank"><img src="https://latex.codecogs.com/gif.latex?A" title="A" /></a>, the area of the sail, and since we can't change <a href="https://www.codecogs.com/eqnedit.php?latex=\rho" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\rho" title="\rho" /></a>, which is the density of the air, we can assume them as constants so, in order to increase <a href="https://www.codecogs.com/eqnedit.php?latex=F_R" target="_blank"><img src="https://latex.codecogs.com/gif.latex?F_R" title="F_R" /></a> we need to increase either <a href="https://www.codecogs.com/eqnedit.php?latex=V" target="_blank"><img src="https://latex.codecogs.com/gif.latex?V" title="V" /></a>, the speed of the apparent wind, or maximize <a href="https://www.codecogs.com/eqnedit.php?latex=C_{L}&space;\cdot&space;sin(\alpha)&space;-&space;C_{D}&space;\cdot&space;cos(\alpha)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_{L}&space;\cdot&space;sin(\alpha)&space;-&space;C_{D}&space;\cdot&space;cos(\alpha)" title="C_{L} \cdot sin(\alpha) - C_{D} \cdot cos(\alpha)" /></a>, which from now on I'll call <a href="https://www.codecogs.com/eqnedit.php?latex=C_R" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R" title="C_R" /></a>, or *"driving force coefficient"*, so

<a href="https://www.codecogs.com/eqnedit.php?latex=C_R&space;=&space;C_{L}&space;\cdot&space;sin(\alpha)&space;-&space;C_{D}&space;\cdot&space;cos(\alpha)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R&space;=&space;C_{L}&space;\cdot&space;sin(\alpha)&space;-&space;C_{D}&space;\cdot&space;cos(\alpha)" title="C_R = C_{L} \cdot sin(\alpha) - C_{D} \cdot cos(\alpha)" /></a>

And since <a href="https://www.codecogs.com/eqnedit.php?latex=C_L" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_L" title="C_L" /></a> and <a href="https://www.codecogs.com/eqnedit.php?latex=C_D" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_D" title="C_D" /></a> depends only on <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a>, we can rewrite the equation:

<a href="https://www.codecogs.com/eqnedit.php?latex=C_R(\alpha)&space;=&space;C_{L}(\alpha)&space;\cdot&space;sin(\alpha)&space;-&space;C_{D}(\alpha)&space;\cdot&space;cos(\alpha)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R(\alpha)&space;=&space;C_{L}(\alpha)&space;\cdot&space;sin(\alpha)&space;-&space;C_{D}(\alpha)&space;\cdot&space;cos(\alpha)" title="C_R(\alpha) = C_{L}(\alpha) \cdot sin(\alpha) - C_{D}(\alpha) \cdot cos(\alpha)" /></a>

so that <a href="https://www.codecogs.com/eqnedit.php?latex=C_R" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R" title="C_R" /></a> depends on <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a> only!

## Example - NACA 0015

In order to explain how it was done back in 2017 as accurately as possible, I'll take the NACA 0015 airfoil for this example. The only auxiliary code I used here is on  `examples/`.

### What does NACA 0015 stands for?
 
 >"The **NACA airfoils** are airfoil shapes for aircraft wings developed by the National Advisory Committee for Aeronautics (NACA)." -- Wikipedia

This one, particularly, is a symmetrical 4-digit airfoil and the *"15"* in *0015* indicates the airfoil has a 15% thickness to chord length ratio or, in other words, it is 15% as thick as it is long.

Basically, this is what it looks like:

<br>
<table align="center">
<caption align="bottom">Picture 4 - NACA 0015 airfoil</caption>
<td><img src="http://airfoiltools.com/images/airfoil/fxlv152-il_l.png"/></td>
</table>
<br>

### NACA 0015 coefficients

Back in 2017, I got these coefficients from a free software called [Javafoil](https://www.mh-aerotools.de/airfoils/javafoil.htm). For this example I'll get data from the same website I got the picture above, [AirfoilTools.com](http://airfoiltools.com), using the Reynolds number approximately 200 (for information on Reynolds number, please check [this](https://en.wikipedia.org/wiki/Reynolds_number)).

So now we're going to plot <a href="https://www.codecogs.com/eqnedit.php?latex=C_L" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_L" title="C_L" /></a>, <a href="https://www.codecogs.com/eqnedit.php?latex=C_D" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_D" title="C_D" /></a> and <a href="https://www.codecogs.com/eqnedit.php?latex=C_R" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R" title="C_R" /></a> against <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a> to see what we're dealing with:

<br>
<table align="center">
<caption align="bottom">Picture 5 - Lift coefficient vs Alpha</caption>
<td><img src="https://github.com/gabriel-milan/robotic-sailboat/blob/master/examples/images/Lift_coeff.png?raw=true"/></td>
</table>
<br>

<br>
<table align="center">
<caption align="bottom">Picture 6 - Drag coefficient vs Alpha</caption>
<td><img src="https://github.com/gabriel-milan/robotic-sailboat/blob/master/examples/images/Drag_coeff.png?raw=true"/></td>
</table>
<br>

<br>
<table align="center">
<caption align="bottom">Picture 7 - Driving coefficient vs Alpha</caption>
<td><img src="https://github.com/gabriel-milan/robotic-sailboat/blob/master/examples/images/Driving_coeff.png?raw=true"/></td>
</table>
<br>

It is pretty intuitive that <a href="https://www.codecogs.com/eqnedit.php?latex=C_D" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_D" title="C_D" /></a> and <a href="https://www.codecogs.com/eqnedit.php?latex=C_D" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_D" title="C_D" /></a> are mirrored on <a href="https://www.codecogs.com/eqnedit.php?latex=X^&plus;" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X^&plus;" title="X^+" /></a> and <a href="https://www.codecogs.com/eqnedit.php?latex=X^-" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X^-" title="X^-" /></a>, and <a href="https://www.codecogs.com/eqnedit.php?latex=C_L" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_L" title="C_L" /></a> on <a href="https://www.codecogs.com/eqnedit.php?latex=X^&plus;" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X^&plus;" title="X^+" /></a> equals <a href="https://www.codecogs.com/eqnedit.php?latex=-C_L" target="_blank"><img src="https://latex.codecogs.com/gif.latex?-C_L" title="-C_L" /></a> on <a href="https://www.codecogs.com/eqnedit.php?latex=X^-" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X^-" title="X^-" /></a>, being <a href="https://www.codecogs.com/eqnedit.php?latex=X" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X" title="X" /></a> the horizontal axis on the charts. This said, from now on we'll only use the <a href="https://www.codecogs.com/eqnedit.php?latex=X^&plus;" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X^&plus;" title="X^+" /></a> side of them.

### The stall issue

As we can see on the *"Lift coefficient vs Alpha"* chart, next to 14 degrees, it has its greatest value and then starts decreasing very fast. This phenomenon is called *stall*, and it's defined by:
>"A stall is a condition in aerodynamics and aviation wherein the angle of attack increases beyond a certain point such that lift begins to decrease. The angle at which this occurs is called the *critical angle of attack*.
>[...]
>[Flow separation](https://en.wikipedia.org/wiki/Flow_separation) begins to occur at small angles of attack while attached flow over the wing is still dominant. As angle of attack increases, the separated regions on the top of the wing increase in size and hinder the wing's ability to create lift. At the critical angle of attack, separated flow is so dominant that additional incr\alphaeases in angle of attack produce less lift and more drag." -- Wikipedia

In other words, it may be risky to choose an *"ideal"* <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a> greater than the *critical angle* (<a href="https://www.codecogs.com/eqnedit.php?latex=\alpha_C" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha_C" title="\alpha_C" /></a>, from now on), even though its <a href="https://www.codecogs.com/eqnedit.php?latex=C_R" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R" title="C_R" /></a> may be greater than <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha_C" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha_C" title="\alpha_C" /></a>'s.

### Choosing Alpha

Okay, now that we know how to do it, let's just do it!

On the auxiliary code I uploaded, there's a function `max_value (data, x_label, y_label)` that returns the greatest <a href="https://www.codecogs.com/eqnedit.php?latex=Y" target="_blank"><img src="https://latex.codecogs.com/gif.latex?Y" title="Y" /></a> value in the dataset for the given <a href="https://www.codecogs.com/eqnedit.php?latex=Y" target="_blank"><img src="https://latex.codecogs.com/gif.latex?Y" title="Y" /></a> versus <a href="https://www.codecogs.com/eqnedit.php?latex=X" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X" title="X" /></a> chart and its respective <a href="https://www.codecogs.com/eqnedit.php?latex=X" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X" title="X" /></a> value. This considered, the output we get for <a href="https://www.codecogs.com/eqnedit.php?latex=C_L&space;\times&space;\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_L&space;\times&space;\alpha" title="C_L \times \alpha" /></a> and <a href="https://www.codecogs.com/eqnedit.php?latex=C_R&space;\times&space;\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R&space;\times&space;\alpha" title="C_R \times \alpha" /></a>, respectively, is the following:

`(14.25, 1.2139)`
`(14.5, 0.254183875029455)`

This is pretty clear if we plot both <a href="https://www.codecogs.com/eqnedit.php?latex=C_L" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_L" title="C_L" /></a> (in red) and <a href="https://www.codecogs.com/eqnedit.php?latex=C_R" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R" title="C_R" /></a> (in green), as follows:

<br>
<table align="center">
<caption align="bottom">Picture 8 - Lift and Driving coefficients vs Alpha</caption>
<td><img src="https://github.com/gabriel-milan/robotic-sailboat/blob/master/examples/images/CL_CR_vs_Alpha.png?raw=true"/></td>
</table>
<br>

Being aware of the *stall* issue, we shall consider taking our <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha&space;=&space;14.25" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha&space;=&space;14.25" title="\alpha = 14.25" /></a> instead of <a href="https://www.codecogs.com/eqnedit.php?latex=14.5" target="_blank"><img src="https://latex.codecogs.com/gif.latex?14.5" title="14.5" /></a> and, as curious as I am, I got to check the difference it will bring me, so I'll check the value of <a href="https://www.codecogs.com/eqnedit.php?latex=C_R" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R" title="C_R" /></a> for <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha&space;=&space;14.25" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha&space;=&space;14.25" title="\alpha = 14.25" /></a> too.

In this particular example, <a href="https://www.codecogs.com/eqnedit.php?latex=C_R&space;=&space;0.253639" target="_blank"><img src="https://latex.codecogs.com/gif.latex?C_R&space;=&space;0.253639" title="C_R = 0.253639" /></a> for <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha&space;=&space;14.25" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha&space;=&space;14.25" title="\alpha = 14.25" /></a>, which will give me 

<a href="https://www.codecogs.com/eqnedit.php?latex=\frac{C_R(14.25)}{C_R(14.5)}&space;=&space;\frac{0.253639}{0.254183}&space;=&space;99,8\%" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\frac{C_R(14.25)}{C_R(14.5)}&space;=&space;\frac{0.253639}{0.254183}&space;=&space;99,8\%" title="\frac{C_R(14.25)}{C_R(14.5)} = \frac{0.253639}{0.254183} = 99,8\%" /></a> of the best performance according to this model.

This is a risk I, personally, wouldn't take, considering the tiny difference on performance. So, for this example, we'll be assuming 

><a href="https://www.codecogs.com/eqnedit.php?latex=\alpha&space;=&space;14.25" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha&space;=&space;14.25" title="\alpha = 14.25" /></a>

as our final answer.

----------

> ---> TODO:
>* Simple example Arduino code to control sail
>* Final considerations
